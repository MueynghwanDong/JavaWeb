<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Ajax Upload</title>
<style>
#progress {
  display: none;
}
</style>
</head>
<body>
    <form id="uploadForm">
        <fieldset>
            <legend>파일업로드</legend>
            <label for="desc">설명</label>
            <input type="text" id="desc" name="desc">
            <label for="file">파일</label>
            <input type="file" id="file" name="file">
            <input type="submit" value="upload">
            <progress id="progress"></progress>
            <div id="message"></div>
        </fieldset>
    </form>
</body>
<script src="../js/jquery-3.2.0.js"></script>
<script>
    var progress = document.getElementById("progress");
    $("#uploadForm").on("submit", function(e) {
        e.preventDefault();
        var formData = new FormData(this);
        formData.append("fileName", document.getElementById("file").files[0].name);
        var url = "../upload";
        $.ajax({
        	xhr: function(){
        	    let xhr = new XMLHttpRequest();
        	    $(xhr.upload).on({
                    loadstart : function(e) {
                        progress.style.display = "inline";
                    },
                    loadend : function(e) {
                        progress.style.display = "none";
                    },
                    progress : function(e) {
                        console.log("progress");
                        progress.max = e.total;
                        progress.value = e.loaded;
                    }
                });
        	    return xhr;
        	},
            url : url,
            type : "post",
            data : formData,
            processData : false,
            contentType : false,
            success : function(data) {
                $("#message").text(data);
            }
        });
    });
</script>
</html>
